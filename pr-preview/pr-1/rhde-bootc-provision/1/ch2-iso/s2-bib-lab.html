<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab: Provision Edge Devices Using Custom Installation Media :: Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</title>
    <link rel="prev" href="s1-bib-iso.html">
    <link rel="next" href="../ch3-qcow2/index.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-bootc-provision/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhde-bootc-provision" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-bib/index.html">Introduction to Bootc Image Builder with Red Hat Device Edge</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-bib/s1-bootc-image-builder.html">Provision Edge Devices Using Bootc Container Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-bib/s2-prereqs-quiz.html">Review of Bootc Container Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-bib/s3-prereqs-lab.html">Lab: Prepare to Build and Deploy Bootc Container Images</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Build Custom RHEL Installation Media Using Image mode for RHEL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s1-bib-iso.html">Provision Edge Devices Using the RHEL Installer</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s2-bib-lab.html">Lab: Provision Edge Devices Using Custom Installation Media</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch3-qcow2/index.html">Build System Images for Clouds and Hypervisors Using Image Mode for RHEL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-qcow2/s1-cloud-init.html">Provision Virtual Edge Devices Using Cloud Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-qcow2/s2-vm-lab.html">Lab: Provision Virtual Edge Devices Using Cloud Images and Cloud-Init</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/1/index.html">samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/1/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</a></li>
    <li><a href="index.html">Build Custom RHEL Installation Media Using Image mode for RHEL</a></li>
    <li><a href="s2-bib-lab.html">Lab: Provision Edge Devices Using Custom Installation Media</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab: Provision Edge Devices Using Custom Installation Media</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>11 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Provision edge devices in a disconnected environment by using a customized RHEL installation media.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Pending review
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_before_you_begin"><a class="anchor" href="#_before_you_begin"></a>Before you Begin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need a <em>development machine</em> running RHEL, to which you have unrestricted sudo access.
The <em>development machine</em> has access to mirrors of RHEL package repositories and bootc container images.</p>
</div>
<div class="paragraph">
<p>These instructions were tested on RHEL 10.0 but should work with minimal or no changes on newer and older RHEL releases, since 9.6.</p>
</div>
<div class="paragraph">
<p>If you are using the course classroom, log in on the <code>workstation</code> VM as the user <code>student</code> with password <code>student</code>.
If not, please adapt the instructions to your test environment.</p>
</div>
<div class="paragraph">
<p>Make sure you verified your test environment by following the <a href="#TBD">first lab</a> of this course.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instructions"><a class="anchor" href="#_instructions"></a>Instructions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will use the bootc image builder utility to create a custom installation ISO, which embeds a bootc container image and a kickstart script for unattended installation, and use that custom ISO as a virtual DVD disk to install RHEL in a new VM.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prepare to start this activity by checking that you have the outcomes from previous activities.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If needed, create a local clone of the sample code repository of this course, but do NOT enter its directory.
Stay on your home directory to start this lab.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>cd</strong>
$ <strong>git clone https://github.com/RedHatQuickCourses/rhde-bootc-samples.git</strong>
Cloning into 'rhde-bootc-samples'...
...</code></pre>
</div>
</div>
</li>
<li>
<p>If needed, login to your private registry.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman login -u student -p redhat registry.lab.example.com:5000</strong>
Login Succeeded!</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that you have a bootc container image named <code>httpd-system:v1.0</code> in your private container registry.
If you do not, please perform the <a href="#TBD">first lab</a>, which builds and publishes that image.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>skopeo inspect --format '{{ json .RepoTags }}' docker://registry.lab.example.com:5000/httpd-system:v1.0</strong>
["v1.0"]</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that you have access to libvirt through its session interface.
If you do not, please perform the preparation tasks from the <a href="#TBD">first lab</a>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>virsh list --all</strong>
 Id   Name   State
--------------------</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is fine if you have some local VMs on your system, as long as there isn&#8217;t a VM named <code>bootc-iso</code>.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Prepare scripts and configuration files you will use to automate creating and testing an installation ISO.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a working directory and copy the sample files to it.
Then make the temporary working directory your current directory.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>mkdir temp-test-iso</strong>
$ <strong>cp rhde-bootc-samples/bib-iso/* temp-test-iso</strong>
$ <strong>cd temp-test-iso</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Review the example bootc image builder TOML file named <code>config.toml</code>.</p>
<div class="paragraph">
<p>Its only content is an embedded Anaconda kickstart script.
Notice that the kickstart script does NOT include an <code>ostreecontainer</code> command, but it configures the following:</p>
</div>
<div class="openblock">
<div class="content">
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Locale, keyboard, and other system settings so the installation can proceed unatended.</p>
</li>
<li>
<p>A new partition table, with default automatic partitioning for RHEL.</p>
</li>
<li>
<p>Dynamic network configuaration, using DHCP.</p>
</li>
<li>
<p>A user named <code>core</code> with password <code>redhat123</code> and an SSH key.</p>
</li>
<li>
<p>The hostname <code>bootc-iso</code>, so you can easily distinguish a terminal in a <em>test VM</em> from a terminal in your <em>development machine</em>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">[customizations.installer.kickstart]
contents = """
lang en_US.UTF-8
keyboard us
timezone Etc/UTC --utc
text

zerombr
clearpart --all --initlabel
reqpart --add-boot
part / --grow --fstype xfs

rootpw --lock
reboot

network --bootproto=dhcp

%post --log=/var/log/anaconda/post-install.log --erroronfail

# local user for console login and SSH
useradd -g wheel core
echo "core:redhat123" | chpasswd
mkdir /home/core/.ssh
cat &gt; /home/core/.ssh/authorized_keys &lt;&lt; EOFSSH
REPLACE_WITH_SSH_PUB_KEY
EOFSSH

echo "bootc-iso" &gt; /etc/hostname
chmod 644 /etc/hostname
%end
"""</code></pre>
</div>
</div>
</li>
<li>
<p>Create an SSH key for use with your test VM and embed it in your TOML file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>ssh-keygen -N '' -f edge-key -C 'initial key for edge devices'</strong>
Generating public/private rsa key pair.
...
$ <strong>SSH_PUB_KEY=$( cat edge-key.pub )</strong>
$ <strong>sed -i "s|REPLACE_WITH_SSH_PUB_KEY|$SSH_PUB_KEY|" config.toml</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Review the <code>bib-iso.sh</code> script which invokes the bootc image builder utility, and which takes the former file as input.</p>
<div class="paragraph">
<p>Make sure you can distinguish between command-line options and arguments for Podman from command-line options and arguments for bootc image builder.</p>
</div>
<div class="openblock">
<div class="content">
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Podman runs from the <code>root</code> user and creates a privileged container, which has access to host namespaces.</p>
</li>
<li>
<p>Podman mounts the container storage of the root user, to where your bootc container image was already pulled.</p>
</li>
<li>
<p>Podman mounts the output folder and TOML file so bootc image builder has access to them.</p>
</li>
<li>
<p>Podman pulls bootc image builder from our private registry.</p>
</li>
<li>
<p>Bootc image builder creates an ISO image and uses a TOML file to pick its kickstart script.</p>
</li>
<li>
<p>Bootc image builder uses the <code>httpd-system:v1.0</code> container image, which was previously pulled.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">#!/bin/bash
set -xeuo pipefail

sudo podman run --rm -it --privileged --pull=newer \
    --security-opt label=type:unconfined_t \
    -v /var/lib/containers/storage:/var/lib/containers/storage \
    -v $(pwd)/config.toml:/config.toml \
    -v $(pwd)/output:/output \
    registry.lab.example.com:5000/rhel10/bootc-image-builder \
    --type iso --config /config.toml \
    registry.lab.example.com:5000/httpd-system:v1.0</code></pre>
</div>
</div>
</li>
<li>
<p>Review the <code>virt-install.sh</code> script which creates a test VM.</p>
<div class="paragraph">
<p>It is designed to be run in text mode, so you do not need to switch to a graphical console or remote desktop session just to view the test VM boot screens, by setting the following options:</p>
</div>
<div class="openblock">
<div class="content">
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>User mode networking with the Passt provider and port-forwarding to enable network connections from your <em>development machine</em> to services running inside the <em>test VM</em>.</p>
</li>
<li>
<p>Direct kernel loading (the <code>--location</code> option) to grab the Linux kernel and initial RAM disk from your ISO image.</p>
</li>
<li>
<p>Kernel command-line arguments to use the kickstart file from your ISO image.</p>
</li>
<li>
<p>A serial console, so boot messages display in the current terminal, which could be an SSH session.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">#!/bin/bash
set -xeuo pipefail

virt-install --name bootc-iso \
--vcpus 2 --memory 4096 \
--disk size=20 \
--network passt,portForward0=8022:22,portForward1=8080:80 \
--location httpd-system.iso,kernel=/images/pxeboot/vmlinuz,initrd=/images/pxeboot/initrd.img \
--os-variant rhel10.0 \
--graphics=none \
--extra-arg inst.ks=hd:LABEL=$LABEL:/osbuild.ks \
--extra-arg console=ttyS0 -v</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Depending on the version of your bootc image builder image, you may be able to use <code>--location</code> without specifying the paths to the kernel and the initial RAM disk.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Create a custom installation ISO.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Log in again on your private registry, but this time as the root user.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo podman login -u student -p redhat registry.lab.example.com:5000</strong>
Login Succeeded!</code></pre>
</div>
</div>
</li>
<li>
<p>Download the bootc container image to the container storage of the root user.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo podman pull registry.lab.example.com:5000/httpd-system:v1.0</strong>
...
Writing manifest to image destination
...</code></pre>
</div>
</div>
</li>
<li>
<p>Create an output directory for the bootc image builder utility.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>mkdir output</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Invoke the script which runs the bootc image builder utility.</p>
<div class="paragraph">
<p>Be patient, it takes several minutes running.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>bash bib-iso.sh</strong>
...
Message: Results saved in .</code></pre>
</div>
</div>
</li>
<li>
<p>Copy the installable ISO from the bootc image builder output directory to a more permanent location, and give it an easily identifiable name.
That file would be distributed to personel responsible for installing actual edge devices.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>cp output/bootiso/install.iso httpd-system.iso</strong></code></pre>
</div>
</div>
</li>
<li>
<p>If you need to rebuild your installation ISO, for whatever reason, we recommend that you first clean your bootc image builder output directory.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo rm -rf output/</strong>*</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Inspect your custom ISO installer image, to confirm that it includes your kickstart file and your bootc container image.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Mount the generated ISO image.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>mkdir temp-iso</strong>
$ <strong>sudo mount -o loop,ro httpd-system.iso temp-iso</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Verify that there are two kickstart scripts inside the iso</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>ls temp-iso/*ks</strong>
temp-iso/osbuild-base.ks  temp-iso/osbuild.ks</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that your kickstart script contents are in the <code>osbuid.ks</code> file and it includes the <code>osbuild-base.ks</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>head -n 5 temp-iso/osbuild.ks</strong>
%include /run/install/repo/osbuild-base.ks
contents = """
lang en_US.UTF-8
keyboard us
timezone Etc/UTC --utc</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the included <code>osbuild-base.ks</code> file provides the <code>ostreecontainer</code> command.
It also provides a <code>%post</code> script that changes the bootc container image reference from the installation media to the reference given to bootc image builder.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>head -n 3 temp-iso/osbuild-base.ks</strong>
ostreecontainer --url=/run/install/repo/container --transport=oci
%post --erroronfail
bootc switch --mutate-in-place --transport registry registry.lab.example.com:5000/httpd-system:v1.0</code></pre>
</div>
</div>
</li>
<li>
<p>Umount the generated ISO image.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo umount temp-iso</strong></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>To demonstrate that the custom installation media works in a disconnected environment, stop the private registry in the virtual labs environment.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>On a new terminal, open an SSH session to the <code>utility</code> VM.
In the classroom environment, The <code>registry</code> host name is an alias to the <code>utility</code> server.
The <code>student</code> user is pre-configured to passwordless SSH access and with <code>sudo</code> rights.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>ssh utility</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Alternatively, you can open a console to the <code>utility</code> VM and log in as the <code>student</code> user.</p>
</li>
<li>
<p>Stop the <code>registry</code> service.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo systemctl stop registry</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Keep this terminal open and its SSH session, because you will return to it in the end of this activity.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Install RHEL in a local VM, using the custom installation ISO, without acessing the container registry.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Verify that your <em>development machine</em> cannot access the private registry anymore.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman search registry.lab.example.com:5000/</strong>
Error: 1 error occurred:
        * couldn't search registry "registry.lab.example.com:5000": pinging container registry registry.lab.example.com:5000: Get "http://registry.lab.example.com:5000/v2/": dial tcp 172.25.250.220:5000: connect: connection refused</code></pre>
</div>
</div>
</li>
<li>
<p>Set an environment variable with the disk label of your generated ISO image.
It is required by the kernel arguments on the <code>virt-install.sh</code> script.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>iso-info httpd-system.iso | grep Volume</strong>
Volume      : RHEL-10-0-BaseOS-x86_64
$ <strong>export LABEL=RHEL-10-0-BaseOS-x86_64</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Invoke the script which creates a <em>test VM</em> from the ISO.</p>
<div class="paragraph">
<p>After the installation is complete and the VM reboots, detattch from its virtual serial console using <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>bash virt-install.sh</strong>
...
[  114.660806] reboot: Restarting system

Domain creation completed.
Restarting guest.
Running text console command: virsh --connect qemu:///session console bootc-iso
Connected to domain 'bootc-iso'
Escape character is ^] (Ctrl + ])</code></pre>
</div>
</div>
</li>
<li>
<p>Alternatively, you can use the <code>virt-install-gui.sh</code> script, which requires a Linux graphical desktop to display the VM console.
This script boots the VM from the ISO file as a virtual CD-ROM drive, by using the <code>--cdrom</code> option instead of the <code>--location</code> option, so it uses the bootloader on the ISO image itself, like a physical device would do from physical media.</p>
</li>
<li>
<p>If something goes wrong and you have to retry creating your VM, first stop and delete it.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>virsh destroy bootc-iso</strong>
Domain 'bootc-iso' destroyed
$ <strong>virsh undefine bootc-iso --remove-all-storage</strong>
Domain 'bootc-iso' has been undefined
Volume 'vda'(/home/student/.local/share/libvirt/images/bootc-iso.qcow2) removed.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Verify that the test VM runs a web server with the mock web application files.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use the SSH hey to access your <em>test VM</em>.
If you are using the same classroom from previous courses, first remove any host key from your known hosts file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>ssh-keygen -R '[127.0.0.1]:8022'</strong>
...
$ <strong>ssh -i edge-key -p 8022 core@127.0.0.1</strong>
...
[core@bootc-iso ~]$</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that your <em>test VM</em> was provisioned using image mode.
The password for the <code>core</code> user is <code>redhat123</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo bootc status</strong>
● Booted image: registry.lab.example.com:5000/httpd-system:v1.0
        Digest: sha256:068dc70b8eca43a0fa3c4a436d7098305898e5235c677f489b69ddc370885f6d
       Version: 10.0 (2025-08-15 21:23:47.500494502 UTC)</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the Apache Web Server is active is your <em>test VM</em> and .</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>systemctl is-active httpd</strong>
active
$ <strong>curl 127.0.0.1</strong>
Misc tests of bootc images and firewalld.</code></pre>
</div>
</div>
</li>
<li>
<p>Terminate the SSH session to your <em>test VM</em>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>exit</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the host can also access the mock web application, through  port-forwarding, similar to how SSH access works.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl 127.0.0.1:8080</strong>
Misc tests of bootc images and firewalld.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Before continuing with this course, restart your private registry.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Return to the terminal with an open SSH session to the <code>utility</code> machine.</p>
</li>
<li>
<p>Start the <code>registry</code> service.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>sudo systemctl start registry</strong></code></pre>
</div>
</div>
</li>
<li>
<p>You can now close your SSH session to the <code>utility</code> VM and verify that your <em>development machine</em> can access the private registry again.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>exit</strong>
$ <strong>podman search registry.lab.example.com:5000/</strong>
NAME                                                                  DESCRIPTION
registry.lab.example.com:5000/httpd-system
...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Stop your <em>test VM</em> to free local TCP ports for the next lab.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>virsh destroy bootc-iso</strong>
Domain 'bootc-iso' destroyed</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>What you did with a VM here, you could do with a physical machine.
You would use the <a href="https://github.com/FedoraQt/MediaWriter/releases">Fedora Media Writer</a> or a similar tool to write your custom ISO image to USB media, and use the BIOS screens of your machine to boot from USB media.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_next"><a class="anchor" href="#_whats_next"></a>What&#8217;s next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next chapter shows how to bootc image builder to build a cloud image and how to use cloud-init to perform day-1 customizations of virtual edge devices and edge cloud instances.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="s1-bib-iso.html">Provision Edge Devices Using the RHEL Installer</a></span>
  <span class="next"><a href="../ch3-qcow2/index.html">Build System Images for Clouds and Hypervisors Using Image Mode for RHEL</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
