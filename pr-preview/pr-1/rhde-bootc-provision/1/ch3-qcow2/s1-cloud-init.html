<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Provision Virtual Edge Devices Using Cloud Images :: Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="s2-vm-lab.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-bootc-provision/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhde-bootc-provision" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-bib/index.html">Introduction to Bootc Image Builder with Red Hat Device Edge</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-bib/s1-bootc-image-builder.html">Provision Edge Devices Using Bootc Container Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-bib/s2-prereqs-quiz.html">Review of Bootc Container Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-bib/s3-prereqs-lab.html">Lab: Prepare to Build and Deploy Bootc Container Images</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch2-iso/index.html">Build Custom RHEL Installation Media Using Image mode for RHEL</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-iso/s1-bib-iso.html">Provision Edge Devices Using the RHEL Installer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch2-iso/s2-bib-lab.html">Lab: Provision Edge Devices Using Custom Installation Media</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Build System Images for Clouds and Hypervisors Using Image Mode for RHEL</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s1-cloud-init.html">Provision Virtual Edge Devices Using Cloud Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s2-vm-lab.html">Lab: Provision Virtual Edge Devices Using Cloud Images and Cloud-Init</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/1/index.html">samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/1/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Provisioning Red Hat Device Edge Systems with Image Mode for RHEL</a></li>
    <li><a href="index.html">Build System Images for Clouds and Hypervisors Using Image Mode for RHEL</a></li>
    <li><a href="s1-cloud-init.html">Provision Virtual Edge Devices Using Cloud Images</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Provision Virtual Edge Devices Using Cloud Images</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>5 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Create custom cloud images for virtual edge devices, by using bootc image builder, and perform day-1 configuration of those virtual devices using Cloud-init.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Pending review
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_virtual_and_cloud_based_edge_devices"><a class="anchor" href="#_virtual_and_cloud_based_edge_devices"></a>Virtual and cloud-based edge devices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Edge computing exists in a variety of shapes and forms.
From far edge sites, where small devices are deployed by themselves in open and hazardous environments, to near edge sites which provide server racks, uninterruptible power supply, and other IT infrastructure which resembles central corporate sites.</p>
</div>
<div class="paragraph">
<p>It makes sense, for some edge scenarios, to run virtualized workloads.
It could be a regular RHEL server, using libvirt virtualization, or a larger OpenShift Virtualization cluster.
It could also be your preferred virtualization vendor or the on-premises services of IaaS cloud providers, such as AWS Outposts.</p>
</div>
<div class="paragraph">
<p>Image mode for RHEL could be used to provision and manage a RHEL-based hypervisor, and also the VM instances running on it.
It could also be used to provision VM instances on any other hypervisor and cloud.
And you could also use image mode for your non-edge cloud instances and data centers.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bootc_image_builder_support_for_cloud_images"><a class="anchor" href="#_bootc_image_builder_support_for_cloud_images"></a>Bootc image builder support for cloud images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use bootc image builder to build a variety of cloud images, from hypervisor-agnostic raw disk images to cloud-provider image formats, such as AWS AMI.
Among the supported formats, yopu can build Qcow2 images for Red Hat OpenStack and Red Hat OpenShift Virtualization.</p>
</div>
<div class="paragraph">
<p>Command-line options provide bootc image builder with cloud credentials, so it can make your new image available on the cloud or hypervisor, but you can also publish the generated disk image in a web server or for creating local VMs.</p>
</div>
<div class="paragraph">
<p>When building RAW and other image types, bootc image builder performs a <code>bootc install</code> command, so the resulting disk image already has a bootc container image deployed and runs its kernel and system settings from its first boot.
That image does not require access to an OCI container image registry to boot and provision, but will try to contact the image registry to check for updates.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customizations_for_generic_disk_images"><a class="anchor" href="#_customizations_for_generic_disk_images"></a>Customizations for generic disk images</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Because raw, cloud, and hypervisor disk images would not run the RHEL installer (Anaconda), you cannot use kickstart scripts to perform day-1 customization, like you would with a custom installation ISO.
Bootc image builder performs a number of customizations, defined in the <code>config.toml</code> file, such as creating initial users and partitioning disks, so it creates disk images which are ready to run.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/10/html/using_image_mode_for_rhel_to_build_deploy_and_manage_operating_systems/creating-bootc-compatible-base-disk-images-by-using-bootc-image-builder" target="_blank" rel="noopener">RHEL product docs</a> provide a number of examples of customizations, but no reference information on the valid customization syntax.
You should refer to the <a href="https://osbuild.org/docs/bootc/#-build-config" target="_blank" rel="noopener">community bootc image builder documentation</a>.</p>
</div>
<div class="paragraph">
<p>The customization syntax recognized by bootc image builder is a subset of the syntax accepted by the RHEL image builder service, which you can use for building system images using <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/10/html/composing_a_customized_rhel_system_image/index" target="_blank" rel="noopener">package mode for RHEL</a> or <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/10/html/composing_installing_and_managing_rhel_for_edge_images/index" target="_blank" rel="noopener">edge images based on rpm-ostree</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_day_1_customization_with_cloud_init"><a class="anchor" href="#_day_1_customization_with_cloud_init"></a>Day-1 customization with Cloud-init</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While creating preconfigured disk images is useful for system testing and for provisioning VMs on RHEL virtualization, most hypervisors and cloud providers support day-1 configuration by using the <a href="https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/10/html/configuring_and_managing_cloud-init_for_rhel/index">Cloud-init service</a>, which is fully supported by RHEL.</p>
</div>
<div class="paragraph">
<p>Cloud-init supports a larger variety of day-1 configurations, including running custom scripts, but you must install and enable it on your bootc container images.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The RHEL image builder service automatically installs and enables cloud-init when you select a cloud or hypervisor image type.
Bootc image builder does NOT make any change to your bootc images.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can perform day-1 configurations using both bootc image builder customizations and cloud-init, but there is little reason to do so.
Most times, it is recommended that you use cloud-init.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_system_images_with_cloud_agents"><a class="anchor" href="#_system_images_with_cloud_agents"></a>System images with cloud agents</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most cloud providers and hypervisors expect that VM instances are able to provide diagnostic information by means of a guest agent or cloud agent.
Such software is provided by the cloud or hypervisor vendor and, though not required, it is recommended.
Sometimes a vendor offers their agents under an open source license, so they are included as part of RHEL.
If not, you must follow the vendor&#8217;s instructions for obtaining and installing the agents, as part of your containerfiles.</p>
</div>
<div class="paragraph">
<p>If you do not include and enable these agents on your bootc container images, you will not get introspection and monitoring features from the hypervisor or cloud management tools.</p>
</div>
<div class="paragraph">
<p>It may also be recommended, and sometimes required, adding special device drivers for virtual networking, storage, and other virtual hardware capabilities.
Depending on the vendor, it may be necessary running the <code>dracut</code> utility, on your containerfile, to add those drivers to the initial RAM disk embedded on your bootc container image.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_next"><a class="anchor" href="#_whats_next"></a>What&#8217;s next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The final lab of this course uses bootc image builder to create a Qcow2 image which you can test using libvirt.
It them shows that the VM misses services to enable integration with the hypervisor, and adds the required packages and settings to a new bootc container image.</p>
</div>
<div class="paragraph">
<p>In addition to demonstrating general practices that you would adapt to any cloud or hypervisor, it demonstrates that you can fully test disk images intended for Red Hat OpenShift Virtualization and Red Hat OpenStack using a RHEL system or any other Linux system with the Libvirt virtualization management layer, such as Fedora Linux.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Build System Images for Clouds and Hypervisors Using Image Mode for RHEL</a></span>
  <span class="next"><a href="s2-vm-lab.html">Lab: Provision Virtual Edge Devices Using Cloud Images and Cloud-Init</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
